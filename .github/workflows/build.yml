name: Build Lemuroid UI Debug APK

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ${{ github.workspace }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive   # fetch all submodules
          fetch-depth: 0

      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '17'

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y cmake ninja-build build-essential pkg-config unzip

      - name: Verify lemuriod-cores submodule
        run: |
          if [ ! -d "lemuroid-cores" ]; then
            echo "Error: lemuriod-cores submodule is missing!"
            exit 1
          fi

      - name: Create build directory
        run: mkdir -p build

      - name: Configure CMake
        run: cmake -S . -B build

      - name: Build debug APK
        run: |
          cmake --build build --config Debug -- -j$(nproc)
          # Adjust above if using Gradle or Android Studio build system

      - name: Locate APK
        run: |
          mkdir -p artifact
          # Assuming the debug APK is here â€” adjust path if different
          cp build/app-debug.apk artifact/ || true

      - name: Upload debug APK
        uses: actions/upload-artifact@v4
        with:
          name: Lemuroid-UI-Debug-APK
          path: artifact/
